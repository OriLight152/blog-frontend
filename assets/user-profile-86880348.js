import{d as L,i as o,c as l,m as e,n as i,g as c,e as n,w as m,j as b,y as C,h as G,u as E,t as I,B as H,C as J,k as S,a as K,b as Q,l as W,r as _,s as X,H as Y,o as Z,A as ee,F as V,f as te,p as se}from"./index-1dfb2302.js";import{N as q}from"./nprogress-a817ebd9.js";import{g as oe,h as ae,d as ne}from"./post-f9c9a4a4.js";import{_ as $}from"./NormalButton.vue_vue_type_script_setup_true_lang-0abceca8.js";import{f as le}from"./index-74aade08.js";import{I as ie,a as re,b as de}from"./IconView-03c59b79.js";import{_ as ue}from"./Pagination.vue_vue_type_script_setup_true_lang-8500eb0f.js";import{_ as ce,a as me}from"./NormalEditor.vue_vue_type_script_setup_true_lang-20168b38.js";import"./_commonjsHelpers-28e086c5.js";import"./_plugin-vue_export-helper-c27b6911.js";const fe={class:"w-full bg-gray-100 my-2 rounded-[12px] overflow-hidden"},pe={class:"flex pt-6 px-4"},he={class:"w-full flex flex-row justify-between"},ve={class:"text-gray-500 flex items-center"},_e={key:0},ge={class:"pl-4 pr-8"},we={class:"text-2xl leading-[60px]"},xe={class:""},ye={class:"flex h-10 mt-4"},ke={class:"h-full flex items-center justify-center hover:bg-gray-500/10 transition-colors"},be={class:"flex-1 flex items-center justify-center hover:bg-gray-500/10 transition-colors"},$e=L({__name:"UserProfilePost",props:{postData:null,editMode:{type:Boolean}},emits:["delete"],setup(s,{emit:a}){return(f,p)=>{const t=G("RouterLink");return o(),l("div",fe,[e("div",pe,[e("div",he,[e("div",ve,[e("span",null,"发布于："+i(c(le)(s.postData.createdAt)),1),n(ie,{class:"w-4 h-4 inline-block ml-2 mr-1"}),e("span",null,i(s.postData.viewCount),1)]),s.editMode?(o(),l("div",_e,[n(t,{class:"mr-1",to:"/post/edit/"+s.postData.pid},{default:m(()=>[n($,null,{default:m(()=>[b("编辑")]),_:1})]),_:1},8,["to"]),n($,{onClick:p[0]||(p[0]=d=>a("delete",s.postData.pid))},{default:m(()=>[b("删除")]),_:1})])):C("",!0)])]),n(t,{to:"/post/"+s.postData.pid},{default:m(()=>[e("div",ge,[e("p",we,i(s.postData.title),1),e("p",xe,i(s.postData.text),1)])]),_:1},8,["to"]),e("div",ye,[n(t,{class:"flex-1",to:{path:"/post/"+s.postData.pid,query:{navigate:"comments"}}},{default:m(()=>[e("div",ke,[n(re,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,i(s.postData._count.comments),1)])]),_:1},8,["to"]),e("div",be,[n(de,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,i(s.postData.like),1)])])])}}}),Pe=e("h2",null,"新文章",-1),De=e("p",{class:"my-2 font-bold"},"标题",-1),Ce=e("p",{class:"my-2 font-bold"},"内容",-1),Ne=L({__name:"NewPost",props:{data:null},emits:["newPost"],setup(s){const a=E(),{setting:f}=I(a);return(p,t)=>(o(),l("div",null,[Pe,De,H(e("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors","onUpdate:modelValue":t[0]||(t[0]=d=>s.data.title=d),placeholder:"有什么新鲜事要向大家分享？",maxlength:"30"},null,512),[[J,s.data.title]]),Ce,c(f).legacyEditor?(o(),S(ce,{key:0,modelValue:s.data.content,"onUpdate:modelValue":t[1]||(t[1]=d=>s.data.content=d)},null,8,["modelValue"])):(o(),S(me,{key:1,class:"h-[400px]",modelValue:s.data.content,"onUpdate:modelValue":t[2]||(t[2]=d=>s.data.content=d)},null,8,["modelValue"])),n($,{class:"mt-2",primary:"",onClick:t[3]||(t[3]=d=>p.$emit("newPost"))},{default:m(()=>[b("发布")]),_:1})]))}}),Ve={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4 relative"},Ie={key:0,class:"absolute top-4 right-4"},Se={key:1,class:"text-center"},Le={key:2,class:"flex flex-col w-full items-center"},Be=["src"],Me={class:"font-bold mt-4"},Re={class:"text-gray-500"},je={class:"mt-2"},qe={class:"mr-2 text-sm bg-yellow-300 px-1 py-0.5 rounded-md"},Ee={class:"mr-2 text-sm bg-red-300 px-1 py-0.5 rounded-md"},Te={key:0,class:"mr-2 text-sm bg-red-500 px-1 py-0.5 rounded-md text-white"},Ue={key:0,class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},ze={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-2"},Ae={key:0,class:"text-center pb-4"},Fe=e("span",null,"这里还什么都没有呢",-1),Oe=[Fe],tt=L({__name:"user-profile",setup(s){const a=E(),f=K(),p=Q(),t=W(),{login:d}=I(a),{params:B}=I(f),P=_(String(f.params.uid)),u=_(),N=_([]),h=_({title:"",content:""}),D=_(1),M=_(0),g=X(()=>d.value&&P.value==String(a.uid));Y(()=>{B.value.uid&&(P.value=String(B.value.uid),w())}),Z(()=>{f.query.page&&(D.value=Number(f.query.page)),w()});async function w(){q.start(),a.pageLoading=!0;const r=ee(Number(P.value)),x=oe(D.value,Number(P.value));return Promise.all([r,x]).then(([v,y])=>{var k;u.value=v.userInfo,N.value=y.posts,M.value=y.count,document.title=((k=u.value)==null?void 0:k.nickname)+"的主页 - Ori博客"}).catch(v=>{t.error(v.message)}).finally(()=>{q.done(),a.pageLoading=!1})}async function T(){if(h.value.title.trim()==""){t.warning("文章标题不可为空");return}if(h.value.content.trim()==""){t.warning("文章内容不可为空");return}ae(a.token,h.value.title.trim(),h.value.content.trim()).then(r=>{t.success("发布成功"),h.value.title="",h.value.content="",w()}).catch(r=>{t.error("发布失败: "+r)})}async function U(r){ne(a.token,r).then(x=>{t.success("删除成功"),w()}).catch(x=>{t.error("删除失败: "+x.message)})}function z(){p.push("/admin")}function A(){localStorage.removeItem("uid"),localStorage.removeItem("token"),localStorage.removeItem("likeCache"),a.login=!1,a.uid=0,a.token=""}function F(r){D.value=r,p.push({query:{page:r}}),w()}return(r,x)=>{var v,y,k,R,j;return o(),l(V,null,[e("div",Ve,[c(g)?(o(),l("div",Ie,[n($,{onClick:z},{default:m(()=>[b("进入后台")]),_:1}),n($,{class:"ml-1",onClick:A},{default:m(()=>[b("退出登录")]),_:1})])):C("",!0),e("h2",null,i(c(g)?"我的":"用户")+"信息",1),u.value?(o(),l("div",Le,[e("img",{class:"rounded-full w-[120px] h-[120px] shadow-md",src:(v=u.value)==null?void 0:v.avatar,alt:"user avatar"},null,8,Be),e("span",Me,i((y=u.value)==null?void 0:y.nickname),1),e("span",Re,"@"+i((k=u.value)==null?void 0:k.name),1),e("div",je,[e("span",qe,"uid:"+i((R=u.value)==null?void 0:R.uid),1),e("span",Ee,"用户组:"+i((j=u.value)==null?void 0:j.role),1),u.value.status!==0?(o(),l("span",Te,"用户已被封禁")):C("",!0)])])):(o(),l("div",Se,"加载中"))]),c(g)?(o(),l("div",Ue,[n(Ne,{data:h.value,onNewPost:T},null,8,["data"])])):C("",!0),e("div",ze,[e("h2",null,i(c(g)?"我的":"用户")+"文章",1),N.value.length==0?(o(),l("div",Ae,Oe)):(o(),l(V,{key:1},[(o(!0),l(V,null,te(N.value,O=>(o(),S($e,{"post-data":O,"edit-mode":c(g),onDelete:U},null,8,["post-data","edit-mode"]))),256)),n(ue,{"current-page":D.value,"total-count":M.value,"page-size":c(se),onChange:F},null,8,["current-page","total-count","page-size"])],64))])],64)}}});export{tt as default};
