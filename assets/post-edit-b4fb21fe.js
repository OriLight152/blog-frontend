import{d as D,u as S,a as z,l as B,t as L,r as i,o as E,S as n,P as H,c as f,j as l,D as m,E as v,m as u,v as M,g,e as h,w as x,z as R,Q as w,i as y}from"./index-cd4eda27.js";import{N as b}from"./nprogress-131c7954.js";import{b as U,f as $}from"./post-97f652fe.js";import{_ as k}from"./NormalButton.vue_vue_type_script_setup_true_lang-285fc55e.js";const j={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},I=u("h2",null,"编辑文章",-1),Q={key:0},K=D({__name:"post-edit",setup(q){const r=S(),_=z(),s=B(),{login:T,uid:N,setting:d}=L(r),C=i(String(_.params.pid)),e=i(null),c=i(null);E(async()=>{if(!T.value){s.warning("请先登录"),n.push("/login");return}b.start(),await V(),b.done()}),H(e,async()=>{console.log("trigger resize textarea"),await w(),p(c.value)});async function V(){r.pageLoading=!0,U(Number(C.value)).then(a=>{var t;if(e.value=a.post,r.pageLoading=!1,N.value!==((t=e.value)==null?void 0:t.author)){s.warning("你没有权限编辑此文章"),n.push("/profile");return}}).catch(a=>{r.pageLoading=!1})}async function P(){var a,t;if(((a=e.value)==null?void 0:a.title.trim())===""){s.warning("文章标题不可为空");return}if(((t=e.value)==null?void 0:t.text.trim())===""){s.warning("文章内容不可为空");return}e.value&&$(r.token,e.value.pid,e.value.title.trim(),e.value.text.trim()).then(o=>{s.success("保存成功"),n.back()}).catch(o=>{s.error("保存失败："+o.message)})}function p(a){d.value.stickyTextarea||(a.style.height="100px",w(()=>{a.style.height=a.scrollHeight+"px"}))}return(a,t)=>(y(),f("div",j,[I,e.value?(y(),f("div",Q,[l(" 标题： "),m(u("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors",type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>e.value.title=o)},null,512),[[v,e.value.title]]),l(" 内容： "),m(u("textarea",{class:M(["w-full min-h-[100px] p-2 rounded-md border hover:border-blue-500 transition-colors overflow-y-hidden",g(d).stickyTextarea?"h-[300px] overflow-y-scroll":""]),"onUpdate:modelValue":t[1]||(t[1]=o=>e.value.text=o),onInput:t[2]||(t[2]=o=>p(o.target)),ref_key:"eleTextarea",ref:c},null,34),[[v,e.value.text]]),h(k,{primary:"",onClick:P},{default:x(()=>[l("保存修改")]),_:1}),h(k,{onClick:t[3]||(t[3]=o=>g(n).back())},{default:x(()=>[l("取消")]),_:1})])):R("",!0)]))}});export{K as default};
