import{d as T,i as n,c as r,m as e,n as i,g as p,e as l,w as f,j as g,z as N,h as G,u as q,t as L,D as M,E as R,v as Q,Q as J,a as K,b as W,l as X,r as w,s as Y,P as Z,o as ee,C as te,F as S,f as se,k as oe,p as ae}from"./index-cd4eda27.js";import{N as j}from"./nprogress-131c7954.js";import{g as ne,h as le,d as re}from"./post-97f652fe.js";import{_ as $}from"./NormalButton.vue_vue_type_script_setup_true_lang-285fc55e.js";import{f as ie}from"./index-b25eac40.js";import{I as ue,a as de,b as ce}from"./IconView-609dbc4c.js";import{_ as me}from"./Pagination.vue_vue_type_script_setup_true_lang-5c6739b4.js";import"./_plugin-vue_export-helper-c27b6911.js";const pe={class:"w-full bg-gray-100 my-2 rounded-[12px] overflow-hidden"},fe={class:"flex pt-6 px-4"},he={class:"w-full flex flex-row justify-between"},ve={class:"text-gray-500 flex items-center"},ge={key:0},_e={class:"pl-4 pr-8"},xe={class:"text-2xl leading-[60px]"},we={class:""},ye={class:"flex h-10 mt-4"},ke={class:"h-full flex items-center justify-center hover:bg-gray-500/10 transition-colors"},be={class:"flex-1 flex items-center justify-center hover:bg-gray-500/10 transition-colors"},Pe=T({__name:"UserProfilePost",props:{postData:null,editMode:{type:Boolean}},emits:["delete"],setup(t,{emit:o}){return(c,h)=>{const s=G("RouterLink");return n(),r("div",pe,[e("div",fe,[e("div",he,[e("div",ve,[e("span",null,"发布于："+i(p(ie)(t.postData.createdAt)),1),l(ue,{class:"w-4 h-4 inline-block ml-2 mr-1"}),e("span",null,i(t.postData.viewCount),1)]),t.editMode?(n(),r("div",ge,[l(s,{class:"mr-1",to:"/post/edit/"+t.postData.pid},{default:f(()=>[l($,null,{default:f(()=>[g("编辑")]),_:1})]),_:1},8,["to"]),l($,{onClick:h[0]||(h[0]=u=>o("delete",t.postData.pid))},{default:f(()=>[g("删除")]),_:1})])):N("",!0)])]),l(s,{to:"/post/"+t.postData.pid},{default:f(()=>[e("div",_e,[e("p",xe,i(t.postData.title),1),e("p",we,i(t.postData.text),1)])]),_:1},8,["to"]),e("div",ye,[l(s,{class:"flex-1",to:{path:"/post/"+t.postData.pid,query:{navigate:"comments"}}},{default:f(()=>[e("div",ke,[l(de,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,i(t.postData._count.comments),1)])]),_:1},8,["to"]),e("div",be,[l(ce,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,i(t.postData.like),1)])])])}}}),$e=e("h2",null,"新文章",-1),De=T({__name:"NewPost",props:{data:null},emits:["newPost"],setup(t){const o=q(),{setting:c}=L(o);function h(s){c.value.stickyTextarea||(s.style.height="100px",J(()=>{s.style.height=s.scrollHeight+"px"}))}return(s,u)=>(n(),r("div",null,[$e,g(" 标题： "),M(e("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors","onUpdate:modelValue":u[0]||(u[0]=m=>t.data.title=m),placeholder:"有什么新鲜事要向大家分享？",maxlength:"30"},null,512),[[R,t.data.title]]),g(" 内容： "),M(e("textarea",{class:Q(["w-full min-h-[100px] p-2 rounded-md border hover:border-blue-500 transition-colors overflow-y-hidden",p(c).stickyTextarea?"h-[300px] overflow-y-scroll":""]),"onUpdate:modelValue":u[1]||(u[1]=m=>t.data.content=m),onInput:u[2]||(u[2]=m=>h(m.target))},null,34),[[R,t.data.content]]),l($,{onClick:u[3]||(u[3]=m=>s.$emit("newPost"))},{default:f(()=>[g("发布")]),_:1})]))}}),Ce={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4 relative"},Ne={key:0,class:"absolute top-4 right-4"},Ie={key:1,class:"text-center"},Se={key:2,class:"flex flex-col w-full items-center"},Le=["src"],Te={class:"font-bold mt-4"},Ve={class:"text-gray-500"},ze={class:"mt-2"},Be={class:"mr-2 text-sm bg-yellow-300 px-1 py-0.5 rounded-md"},Me={class:"mr-2 text-sm bg-red-300 px-1 py-0.5 rounded-md"},Re={key:0,class:"mr-2 text-sm bg-red-500 px-1 py-0.5 rounded-md text-white"},je={key:0,class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},qe={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-2"},Ee={key:0,class:"text-center pb-4"},Ue=e("span",null,"这里还什么都没有呢",-1),Ae=[Ue],Xe=T({__name:"user-profile",setup(t){const o=q(),c=K(),h=W(),s=X(),{login:u}=L(o),{params:m}=L(c),D=w(String(c.params.uid)),d=w(),I=w([]),v=w({title:"",content:""}),C=w(1),V=w(0),y=Y(()=>u.value&&D.value==String(o.uid));Z(m,(a,_)=>{a.uid&&(D.value=String(a.uid),k())}),ee(()=>{c.query.page&&(C.value=Number(c.query.page)),k()});async function k(){j.start(),o.pageLoading=!0;const a=te(Number(D.value)),_=ne(C.value,Number(D.value));return Promise.all([a,_]).then(([x,b])=>{var P;d.value=x.userInfo,I.value=b.posts,V.value=b.count,document.title=((P=d.value)==null?void 0:P.nickname)+"的主页 - Ori博客"}).catch(x=>{s.error(x.message)}).finally(()=>{j.done(),o.pageLoading=!1})}async function E(){if(v.value.title.trim()==""){s.warning("文章标题不可为空");return}if(v.value.content.trim()==""){s.warning("文章内容不可为空");return}le(o.token,v.value.title.trim(),v.value.content.trim()).then(a=>{s.success("发布成功"),v.value.title="",v.value.content="",k()}).catch(a=>{s.error("发布失败: "+a)})}async function U(a){re(o.token,a).then(_=>{s.success("删除成功"),k()}).catch(_=>{s.error("删除失败: "+_.message)})}function A(){h.push("/admin")}function F(){localStorage.removeItem("uid"),localStorage.removeItem("token"),localStorage.removeItem("likeCache"),o.login=!1,o.uid=0,o.token=""}function H(a){C.value=a,h.push({query:{page:a}}),k()}return(a,_)=>{var x,b,P,z,B;return n(),r(S,null,[e("div",Ce,[p(y)?(n(),r("div",Ne,[l($,{onClick:A},{default:f(()=>[g("进入后台")]),_:1}),l($,{class:"ml-1",onClick:F},{default:f(()=>[g("退出登录")]),_:1})])):N("",!0),e("h2",null,i(p(y)?"我的":"用户")+"信息",1),d.value?(n(),r("div",Se,[e("img",{class:"rounded-full w-[120px] h-[120px] shadow-md",src:(x=d.value)==null?void 0:x.avatar,alt:"user avatar"},null,8,Le),e("span",Te,i((b=d.value)==null?void 0:b.nickname),1),e("span",Ve,"@"+i((P=d.value)==null?void 0:P.name),1),e("div",ze,[e("span",Be,"uid:"+i((z=d.value)==null?void 0:z.uid),1),e("span",Me,"用户组:"+i((B=d.value)==null?void 0:B.role),1),d.value.status!==0?(n(),r("span",Re,"用户已被封禁")):N("",!0)])])):(n(),r("div",Ie,"加载中"))]),p(y)?(n(),r("div",je,[l(De,{data:v.value,onNewPost:E},null,8,["data"])])):N("",!0),e("div",qe,[e("h2",null,i(p(y)?"我的":"用户")+"文章",1),I.value.length==0?(n(),r("div",Ee,Ae)):(n(),r(S,{key:1},[(n(!0),r(S,null,se(I.value,O=>(n(),oe(Pe,{"post-data":O,"edit-mode":p(y),onDelete:U},null,8,["post-data","edit-mode"]))),256)),l(me,{"current-page":C.value,"total-count":V.value,"page-size":p(ae),onChange:H},null,8,["current-page","total-count","page-size"])],64))])],64)}}});export{Xe as default};
