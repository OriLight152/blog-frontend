import{d as N,u as C,a as B,n as D,t as M,r as u,o as P,Q as n,c as d,j as E,D as L,k as l,f as m,m as p,e as c,w as f,A as S,h as i,i as v}from"./index-f13a1ebc.js";import{N as _}from"./nprogress-a817ebd9.js";import{b as T,f as U}from"./post-a2de01dc.js";import{_ as g}from"./NormalButton.vue_vue_type_script_setup_true_lang-3abfc611.js";import{_ as $,M as R}from"./NormalEditor.vue_vue_type_script_setup_true_lang-49130ed4.js";import"./_commonjsHelpers-28e086c5.js";import"./index-74aade08.js";import"./IconView-a0ac3a23.js";import"./_plugin-vue_export-helper-c27b6911.js";const j={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},A=l("h2",null,"编辑文章",-1),Q={key:0},q=l("p",{class:"my-2 font-bold"},"标题",-1),z=l("p",{class:"my-2 font-bold"},"内容",-1),F={class:"mt-2"},ee=N({__name:"post-edit",setup(G){const r=C(),h=B(),o=D(),{login:w,uid:x,setting:k}=M(r),y=u(String(h.params.pid)),e=u(null);u(null),P(async()=>{if(!w.value){o.warning("请先登录"),n.push("/login");return}_.start(),await b(),_.done()});async function b(){r.pageLoading=!0,T(Number(y.value)).then(s=>{var t;if(e.value=s.post,r.pageLoading=!1,x.value!==((t=e.value)==null?void 0:t.author)){o.warning("你没有权限编辑此文章"),n.push("/profile");return}}).catch(s=>{r.pageLoading=!1})}async function V(){var s,t;if(((s=e.value)==null?void 0:s.title.trim())===""){o.warning("文章标题不可为空");return}if(((t=e.value)==null?void 0:t.text.trim())===""){o.warning("文章内容不可为空");return}e.value&&U(r.token,e.value.pid,e.value.title.trim(),e.value.text.trim()).then(a=>{o.success("保存成功"),n.back()}).catch(a=>{o.error("保存失败："+a.message)})}return(s,t)=>(i(),d("div",j,[A,e.value?(i(),d("div",Q,[q,E(l("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors",type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>e.value.title=a)},null,512),[[L,e.value.title]]),z,m(k).legacyEditor?(i(),p($,{key:0,modelValue:e.value.text,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.text=a)},null,8,["modelValue"])):(i(),p(R,{key:1,class:"h-[calc(100vh-400px)]",modelValue:e.value.text,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.text=a)},null,8,["modelValue"])),l("div",F,[c(g,{primary:"",onClick:V},{default:f(()=>[v("保存修改")]),_:1}),c(g,{onClick:t[3]||(t[3]=a=>m(n).back())},{default:f(()=>[v("取消")]),_:1})])])):S("",!0)]))}});export{ee as default};
