import{d as V,u as B,q as C,s as D,t as P,r as n,k as S,B as z,C as l,c as i,y as u,v as h,x as m,a as r,e as M,w as E,h as g,g as H,f as R,z as x,o as d}from"./index-f002ee70.js";import{N as w,a as U,e as q}from"./post-a4472ac1.js";import{N as I}from"./NormalButton-040d8d66.js";const j={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},A=r("h2",null,"编辑文章",-1),F={key:0},G={key:1},Q=V({__name:"EditPost",setup(J){const c=B(),y=C(),s=D(),{devMode:_,login:b,uid:k}=P(c),p=n(String(y.params.pid)),e=n(null),v=n(null);S(async()=>{w.start(),await N(),w.done()}),z(e,async()=>{console.log("trigger resize textarea"),await x(),f(v.value)});async function N(){U(Number(p.value)).then(a=>{var t;if(e.value=a.post,!b.value){s.warning("请先登录"),l.push("/login");return}if(k.value!==((t=e.value)==null?void 0:t.author)){s.warning("你没有权限编辑此文章"),l.push("/profile");return}}).catch(a=>{})}async function T(){var a,t;if(((a=e.value)==null?void 0:a.title.trim())===""){s.warning("文章标题不可为空");return}if(((t=e.value)==null?void 0:t.text.trim())===""){s.warning("文章内容不可为空");return}e.value&&q(c.token,e.value.pid,e.value.title.trim(),e.value.text.trim()).then(o=>{s.success("保存成功"),l.push("/post/"+p.value)}).catch(o=>{s.error("保存失败："+o)})}async function f(a){a.style.height="100px",await x(),a.style.height=a.scrollHeight+"px"}return(a,t)=>(d(),i("div",j,[A,e.value?(d(),i("div",F,[u(" 标题： "),h(r("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors",type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>e.value.title=o)},null,512),[[m,e.value.title]]),u(" 内容： "),h(r("textarea",{class:"w-full h-[100px] p-2 rounded-md border resize-none hover:border-blue-500 transition-colors overflow-y-hidden","onUpdate:modelValue":t[1]||(t[1]=o=>e.value.text=o),onInput:t[2]||(t[2]=o=>f(o.target)),ref_key:"eleTextarea",ref:v},null,544),[[m,e.value.text]]),M(I,{onClick:T},{default:E(()=>[u("保存修改")]),_:1})])):g("",!0),H(_)?(d(),i("div",G,[r("div",null,"postData: "+R(e.value),1)])):g("",!0)]))}});export{Q as default};
