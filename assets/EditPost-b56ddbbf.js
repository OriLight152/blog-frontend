import{d as k,g as T,q as V,h as B,t as C,r,o as P,B as z,C as n,c as v,y as l,v as f,x as h,j as u,b as D,w as S,s as E,z as m,e as x}from"./index-d5b50c01.js";import{N as g,d as H,f as M}from"./nprogress-52d93cfb.js";import{N as R}from"./NormalButton-0ee94306.js";const U={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},j=u("h2",null,"编辑文章",-1),q={key:0},J=k({__name:"EditPost",setup(I){const i=T(),w=V(),s=B(),{login:y,uid:b}=C(i),d=r(String(w.params.pid)),e=r(null),c=r(null);P(async()=>{g.start(),await _(),g.done()}),z(e,async()=>{console.log("trigger resize textarea"),await m(),p(c.value)});async function _(){H(Number(d.value)).then(o=>{var t;if(e.value=o.post,!y.value){s.warning("请先登录"),n.push("/login");return}if(b.value!==((t=e.value)==null?void 0:t.author)){s.warning("你没有权限编辑此文章"),n.push("/profile");return}}).catch(o=>{})}async function N(){var o,t;if(((o=e.value)==null?void 0:o.title.trim())===""){s.warning("文章标题不可为空");return}if(((t=e.value)==null?void 0:t.text.trim())===""){s.warning("文章内容不可为空");return}e.value&&M(i.token,e.value.pid,e.value.title.trim(),e.value.text.trim()).then(a=>{s.success("保存成功"),n.push("/post/"+d.value)}).catch(a=>{s.error("保存失败："+a)})}function p(o){o.style.height="100px",m(()=>{o.style.height=o.scrollHeight+"px"})}return(o,t)=>(x(),v("div",U,[j,e.value?(x(),v("div",q,[l(" 标题： "),f(u("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors",type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>e.value.title=a)},null,512),[[h,e.value.title]]),l(" 内容： "),f(u("textarea",{class:"w-full h-[100px] p-2 rounded-md border resize-none hover:border-blue-500 transition-colors overflow-y-hidden","onUpdate:modelValue":t[1]||(t[1]=a=>e.value.text=a),onInput:t[2]||(t[2]=a=>p(a.target)),ref_key:"eleTextarea",ref:c},null,544),[[h,e.value.text]]),D(R,{onClick:N},{default:S(()=>[l("保存修改")]),_:1})])):E("",!0)]))}});export{J as default};
