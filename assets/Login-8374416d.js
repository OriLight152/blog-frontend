import{d as T,u as P,j as $,r as h,n as m,c as w,k as e,F as C,A as o,B as d,K as B,a as p,w as v,G as x,e as _,L as g,h as r,M as F,J as I,N as K,g as k}from"./index-e63abaa2.js";import{_ as f}from"./NormalButton.vue_vue_type_script_setup_true_lang-3a9d7b55.js";const R={class:"w-full"},j={class:"w-[400px] bg-white mt-4 mx-auto px-8 pt-2 pb-6 rounded-[10px] overflow-hidden shadow-sm"},z=e("h1",{class:"text-center"},"用户登录",-1),D={class:"border rounded-md mt-10"},O={class:"flex items-center pl-3 border-b"},G=e("span",{class:"w-[50px]"},"用户名",-1),J={class:"flex items-center pl-3"},Z=e("span",{class:"w-[50px]"},"密码",-1),q=["onKeydown"],H={class:"flex flex-col justify-center mt-10"},Q=e("h1",{class:"text-center"},"用户注册",-1),W={class:"border rounded-md mt-10"},X={class:"px-3 border-b"},Y={class:"flex items-center"},ee=e("span",{class:"w-[50px] shrink-0"},"用户名",-1),se={class:"text-center text-red-500 pb-1"},te={class:"px-3 border-b"},ae={class:"flex items-center"},ne=e("span",{class:"w-[50px] shrink-0"},"昵称",-1),le={class:"text-center text-red-500 pb-1"},oe={class:"px-3 border-b"},ie={class:"flex items-center"},re=e("span",{class:"w-[50px] shrink-0"},"邮箱",-1),de={class:"text-center text-red-500 pb-1"},ue={class:"px-3 border-b"},ce={class:"flex items-center"},me=e("span",{class:"w-[50px] shrink-0"},"密码",-1),pe={class:"text-center text-red-500 pb-1"},ve={class:"pl-3 mt-2"},xe=e("span",null,"性别",-1),_e={for:"sex_male",class:"ml-2"},fe={for:"sex_female",class:"ml-2"},he={for:"sex_secret",class:"ml-2"},we={class:"flex flex-col justify-center mt-10"},ye=T({__name:"Login",setup(ge){const M={mounted:l=>l.focus()},u=P(),n=$(),A=/^[a-z0-9-_]{5,12}$/,N=/^(?=.*?[a-zA-Z])(?=.*?[0-9]).{6,30}$/,L=/[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+/,c=h(!1),i=h({username:"",password:""}),s=h({username:"",nickname:"",password:"",email:"",sex:"MALE"}),b=m(()=>A.test(s.value.username)||s.value.username==""),y=m(()=>s.value.nickname.length>=2&&s.value.nickname.length<=20||s.value.nickname==""),V=m(()=>N.test(s.value.password)||s.value.password==""),U=m(()=>L.test(s.value.email)||s.value.email=="");async function E(){if(i.value.username.trim()===""){n.warning("用户名不可为空");return}if(i.value.password.trim()===""){n.warning("密码不可为空");return}F(i.value.username.trim(),i.value.password.trim()).then(l=>{n.success("登录成功"),u.login=!0,u.uid=l.id,u.token=l.token,l.role==="ADMIN"&&(u.isAdmin=!0),u.likeCache={POST:[],COMMENT:[]},localStorage.setItem("uid",l.id),localStorage.setItem("token",l.token),I.push("/profile")}).catch(l=>{n.error("登录失败："+l)})}async function S(){if(s.value.username.trim()===""){n.warning("用户名不可为空");return}if(s.value.nickname.trim()===""){n.warning("昵称不可为空");return}if(s.value.email.trim()===""){n.warning("邮箱不可为空");return}if(s.value.password.trim()===""){n.warning("密码不可为空");return}if(!b.value){n.warning("用户名格式错误");return}if(!y.value){n.warning("昵称格式错误");return}if(!U.value){n.warning("邮箱格式错误");return}if(!V.value){n.warning("密码格式错误");return}K(s.value.username.trim(),s.value.nickname.trim(),s.value.password.trim(),s.value.email.trim(),s.value.sex).then(l=>{n.success("注册成功"),c.value=!1}).catch(l=>{n.error("注册失败："+l)})}return(l,t)=>(k(),w("div",R,[e("div",j,[c.value?(k(),w(C,{key:1},[Q,e("div",W,[e("div",X,[e("div",Y,[ee,o(e("input",{class:"flex-1 h-[40px] px-3 outline-none",type:"text",placeholder:"请输入用户名","onUpdate:modelValue":t[3]||(t[3]=a=>s.value.username=a)},null,512),[[d,s.value.username]])]),o(e("div",se,"用户名由小写字母、数字、下划线组成，长度5-12字符",512),[[x,!_(b)]])]),e("div",te,[e("div",ae,[ne,o(e("input",{class:"flex-1 h-[40px] px-3 outline-none",type:"text",placeholder:"请输入昵称","onUpdate:modelValue":t[4]||(t[4]=a=>s.value.nickname=a)},null,512),[[d,s.value.nickname]])]),o(e("div",le,"昵称长度2-20字符",512),[[x,!_(y)]])]),e("div",oe,[e("div",ie,[re,o(e("input",{class:"flex-1 h-[40px] px-3 outline-none",type:"email",placeholder:"请输入邮箱","onUpdate:modelValue":t[5]||(t[5]=a=>s.value.email=a)},null,512),[[d,s.value.email]])]),o(e("div",de,"邮箱格式不正确",512),[[x,!_(U)]])]),e("div",ue,[e("div",ce,[me,o(e("input",{class:"flex-1 h-[40px] px-3 outline-none",type:"password",placeholder:"请输入密码","onUpdate:modelValue":t[6]||(t[6]=a=>s.value.password=a)},null,512),[[d,s.value.password]])]),o(e("div",pe,"密码需要包含 [大写或小写字母] 和 [数字] ，长度6-30字符",512),[[x,!_(V)]])])]),e("div",ve,[xe,e("label",_e,[o(e("input",{type:"radio",name:"sex",id:"sex_male",value:"MALE","onUpdate:modelValue":t[7]||(t[7]=a=>s.value.sex=a)},null,512),[[g,s.value.sex]]),r(" 男")]),e("label",fe,[o(e("input",{type:"radio",name:"sex",id:"sex_female",value:"FEMALE","onUpdate:modelValue":t[8]||(t[8]=a=>s.value.sex=a)},null,512),[[g,s.value.sex]]),r(" 女")]),e("label",he,[o(e("input",{type:"radio",name:"sex",id:"sex_secret",value:"SECRET","onUpdate:modelValue":t[9]||(t[9]=a=>s.value.sex=a)},null,512),[[g,s.value.sex]]),r(" 保密")])]),e("div",we,[p(f,{primary:"",onClick:S},{default:v(()=>[r("注册")]),_:1}),p(f,{class:"mt-2",onClick:t[10]||(t[10]=a=>c.value=!1)},{default:v(()=>[r("返回登录")]),_:1})])],64)):(k(),w(C,{key:0},[z,e("div",D,[e("div",O,[G,o(e("input",{class:"flex-1 h-[40px] px-3 outline-none",type:"text",placeholder:"请输入用户名",maxlength:"12","onUpdate:modelValue":t[0]||(t[0]=a=>i.value.username=a)},null,512),[[d,i.value.username],[M]])]),e("div",J,[Z,o(e("input",{class:"flex-1 h-[40px] px-3 outline-none",type:"password",placeholder:"请输入密码",maxlength:"36","onUpdate:modelValue":t[1]||(t[1]=a=>i.value.password=a),onKeydown:B(E,["enter"])},null,40,q),[[d,i.value.password]])])]),e("div",H,[p(f,{primary:"",onClick:E},{default:v(()=>[r("登录")]),_:1}),p(f,{class:"mt-2",onClick:t[2]||(t[2]=a=>c.value=!0)},{default:v(()=>[r("前往注册")]),_:1})])],64))])]))}});export{ye as default};
