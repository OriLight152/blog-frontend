import{d as N,g as n,c as r,k as e,l as d,e as f,a as l,w as m,h as p,x as $,f as G,A as M,B as R,I as O,u as J,v as K,s as Q,j as W,t as T,r as _,n as X,H as Y,o as Z,z as ee,F as I,b as te,i as se,p as oe}from"./index-e63abaa2.js";import{N as j}from"./nprogress-131c7954.js";import{g as ae,h as ne,d as le}from"./post-d7414536.js";import{_ as b}from"./NormalButton.vue_vue_type_script_setup_true_lang-3a9d7b55.js";import{f as ie}from"./index-b25eac40.js";import{I as re,a as de,b as ue}from"./IconView-0aa94a44.js";import{_ as ce}from"./Pagination.vue_vue_type_script_setup_true_lang-0403b34b.js";const me={class:"w-full bg-gray-100 my-2 rounded-[12px] overflow-hidden"},he={class:"flex pt-6 px-4"},fe={class:"w-full flex flex-row justify-between"},pe={class:"text-gray-500 flex items-center"},ve={key:0},ge={class:"pl-4 pr-8"},_e={class:"text-2xl leading-[60px]"},xe={class:""},we={class:"flex h-10 mt-4"},ye={class:"h-full flex items-center justify-center hover:bg-gray-500/10 transition-colors"},ke={class:"flex-1 flex items-center justify-center hover:bg-gray-500/10 transition-colors"},be=N({__name:"UserProfilePost",props:{postData:null,editMode:{type:Boolean}},emits:["delete"],setup(s,{emit:o}){return(u,a)=>{const t=G("RouterLink");return n(),r("div",me,[e("div",he,[e("div",fe,[e("div",pe,[e("span",null,"发布于："+d(f(ie)(s.postData.createdAt)),1),l(re,{class:"w-4 h-4 inline-block ml-2 mr-1"}),e("span",null,d(s.postData.viewCount),1)]),s.editMode?(n(),r("div",ve,[l(t,{class:"mr-1",to:"/post/edit/"+s.postData.pid},{default:m(()=>[l(b,null,{default:m(()=>[p("编辑")]),_:1})]),_:1},8,["to"]),l(b,{onClick:a[0]||(a[0]=S=>o("delete",s.postData.pid))},{default:m(()=>[p("删除")]),_:1})])):$("",!0)])]),l(t,{to:"/post/"+s.postData.pid},{default:m(()=>[e("div",ge,[e("p",_e,d(s.postData.title),1),e("p",xe,d(s.postData.text),1)])]),_:1},8,["to"]),e("div",we,[l(t,{class:"flex-1",to:{path:"/post/"+s.postData.pid,query:{navigate:"comments"}}},{default:m(()=>[e("div",ye,[l(de,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,d(s.postData._count.comments),1)])]),_:1},8,["to"]),e("div",ke,[l(ue,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,d(s.postData.like),1)])])])}}}),Pe=e("h2",null,"新博文",-1),$e=N({__name:"NewPost",props:{data:null},emits:["newPost"],setup(s){async function o(u){u.style.height="100px",await O(),u.style.height=u.scrollHeight+"px"}return(u,a)=>(n(),r("div",null,[Pe,p(" 标题： "),M(e("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors","onUpdate:modelValue":a[0]||(a[0]=t=>s.data.title=t),placeholder:"有什么新鲜事要向大家分享？",maxlength:"30"},null,512),[[R,s.data.title]]),p(" 内容： "),M(e("textarea",{class:"w-full min-h-[100px] p-2 rounded-md border hover:border-blue-500 transition-colors overflow-y-hidden","onUpdate:modelValue":a[1]||(a[1]=t=>s.data.content=t),placeholder:"",onInput:a[2]||(a[2]=t=>o(t.target))},null,544),[[R,s.data.content]]),l(b,{onClick:a[3]||(a[3]=t=>u.$emit("newPost"))},{default:m(()=>[p("发布")]),_:1})]))}}),De={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4 relative"},Ce={key:0,class:"absolute top-4 right-4"},Ie={key:1,class:"text-center"},Ne={key:2,class:"flex flex-col w-full items-center"},Se=["src"],Le={class:"font-bold mt-4"},Ve={class:"text-gray-500"},Be={class:"mt-2"},Me={class:"mr-2 text-sm bg-yellow-300 px-1 py-0.5 rounded-md"},Re={class:"mr-2 text-sm bg-red-300 px-1 py-0.5 rounded-md"},Te={key:0,class:"mr-2 text-sm bg-red-500 px-1 py-0.5 rounded-md text-white"},je={key:0,class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},ze={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-2"},Ue={key:0,class:"text-center pb-4"},Ae=e("span",null,"这里还什么都没有呢",-1),He=[Ae],Qe=N({__name:"UserProfile",setup(s){const o=J(),u=K(),a=Q(),t=W(),{login:S}=T(o),{params:z}=T(u),P=_(String(u.params.uid)),c=_(),D=_([]),h=_({title:"",content:""}),C=_(1),L=_(0),x=X(()=>S.value&&P.value==String(o.uid));Y(z,(i,v)=>{i.uid&&(P.value=String(i.uid),w())}),Z(()=>{w()});async function w(){j.start(),o.pageLoading=!0;const i=ee(Number(P.value)),v=ae(C.value,Number(P.value));return Promise.all([i,v]).then(([g,y])=>{var k;c.value=g.userInfo,D.value=y.posts,L.value=y.count,document.title=((k=c.value)==null?void 0:k.nickname)+"的主页 - 博客"}).catch(g=>{t.error(g.message)}).finally(()=>{j.done(),o.pageLoading=!1})}async function U(){if(h.value.title.trim()==""){t.warning("文章标题不可为空");return}if(h.value.content.trim()==""){t.warning("文章内容不可为空");return}ne(o.token,h.value.title.trim(),h.value.content.trim()).then(i=>{t.success("发布成功"),h.value.title="",h.value.content="",w()}).catch(i=>{t.error("发布失败: "+i)})}async function A(i){le(o.token,i).then(v=>{t.success("删除成功"),w()}).catch(v=>{t.error("删除失败: "+v.message)})}function H(){a.push("/admin")}function E(){localStorage.removeItem("uid"),localStorage.removeItem("token"),localStorage.removeItem("likeCache"),o.login=!1,o.uid=0,o.token=""}async function F(i){C.value=i,await w()}return(i,v)=>{var g,y,k,V,B;return n(),r(I,null,[e("div",De,[f(x)?(n(),r("div",Ce,[l(b,{onClick:H},{default:m(()=>[p("进入后台")]),_:1}),l(b,{class:"ml-1",onClick:E},{default:m(()=>[p("退出登录")]),_:1})])):$("",!0),e("h2",null,d(f(x)?"我的":"用户")+"信息",1),c.value?(n(),r("div",Ne,[e("img",{class:"rounded-full w-[120px] h-[120px] shadow-md",src:(g=c.value)==null?void 0:g.avatar,alt:"user avatar"},null,8,Se),e("span",Le,d((y=c.value)==null?void 0:y.nickname),1),e("span",Ve,"@"+d((k=c.value)==null?void 0:k.name),1),e("div",Be,[e("span",Me,"uid:"+d((V=c.value)==null?void 0:V.uid),1),e("span",Re,"用户组:"+d((B=c.value)==null?void 0:B.role),1),c.value.status!==0?(n(),r("span",Te,"用户已被封禁")):$("",!0)])])):(n(),r("div",Ie,"加载中"))]),f(x)?(n(),r("div",je,[l($e,{data:h.value,onNewPost:U},null,8,["data"])])):$("",!0),e("div",ze,[e("h2",null,d(f(x)?"我的":"用户")+"文章",1),D.value.length==0?(n(),r("div",Ue,He)):(n(),r(I,{key:1},[(n(!0),r(I,null,te(D.value,q=>(n(),se(be,{"post-data":q,"edit-mode":f(x),onDelete:A},null,8,["post-data","edit-mode"]))),256)),l(ce,{"current-page":C.value,"total-count":L.value,"page-size":f(oe),onChange:F},null,8,["current-page","total-count","page-size"])],64))])],64)}}});export{Qe as default};
