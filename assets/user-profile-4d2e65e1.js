import{d as S,i as o,c as l,l as e,s as i,g as c,e as n,w as m,j as b,B as C,h as G,u as j,t as V,k as J,E as H,n as I,a as K,b as Q,q as W,r as _,y as X,J as Y,o as Z,D as ee,f as te,F as M,m as se,p as oe}from"./index-0161809b.js";import{N as R}from"./nprogress-a817ebd9.js";import{g as ae,n as ne,d as le}from"./post-a1a88d4f.js";import{_ as $}from"./NormalButton.vue_vue_type_script_setup_true_lang-9f1676ca.js";import{f as ie}from"./index-74aade08.js";import{I as re,a as de}from"./IconComment-12e47474.js";import{I as ue}from"./IconView-77d37de5.js";import{_ as ce}from"./Pagination.vue_vue_type_script_setup_true_lang-b35ca8de.js";import{_ as me,a as fe}from"./NormalEditor.vue_vue_type_script_setup_true_lang-c3397fba.js";import"./_commonjsHelpers-28e086c5.js";import"./_plugin-vue_export-helper-c27b6911.js";const pe={class:"w-full bg-gray-100 my-2 rounded-[12px] overflow-hidden"},he={class:"flex pt-6 px-4"},ve={class:"w-full flex flex-row justify-between"},_e={class:"text-gray-500 flex items-center"},ge={key:0},we={class:"pl-4 pr-8"},ye={class:"text-2xl leading-[60px]"},xe={class:""},ke={class:"flex h-10 mt-4"},be={class:"h-full flex items-center justify-center hover:bg-gray-500/10 transition-colors"},$e={class:"flex-1 flex items-center justify-center hover:bg-gray-500/10 transition-colors"},Pe=S({__name:"UserProfilePost",props:{postData:null,editMode:{type:Boolean}},emits:["delete"],setup(s,{emit:a}){return(f,p)=>{const t=G("RouterLink");return o(),l("div",pe,[e("div",he,[e("div",ve,[e("div",_e,[e("span",null,"发布于："+i(c(ie)(s.postData.createdAt)),1),n(ue,{class:"w-4 h-4 inline-block ml-2 mr-1"}),e("span",null,i(s.postData.viewCount),1)]),s.editMode?(o(),l("div",ge,[n(t,{class:"mr-1",to:"/post/edit/"+s.postData.pid},{default:m(()=>[n($,null,{default:m(()=>[b("编辑")]),_:1})]),_:1},8,["to"]),n($,{onClick:p[0]||(p[0]=d=>a("delete",s.postData.pid))},{default:m(()=>[b("删除")]),_:1})])):C("",!0)])]),n(t,{to:"/post/"+s.postData.pid},{default:m(()=>[e("div",we,[e("p",ye,i(s.postData.title),1),e("p",xe,i(s.postData.text),1)])]),_:1},8,["to"]),e("div",ke,[n(t,{class:"flex-1",to:{path:"/post/"+s.postData.pid,query:{navigate:"comments"}}},{default:m(()=>[e("div",be,[n(re,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,i(s.postData._count.comments),1)])]),_:1},8,["to"]),e("div",$e,[n(de,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,i(s.postData.like),1)])])])}}}),De=e("h2",null,"新文章",-1),Ce=e("p",{class:"my-2 font-bold"},"标题",-1),Ne=e("p",{class:"my-2 font-bold"},"内容",-1),Ve=S({__name:"NewPost",props:{data:null},emits:["newPost"],setup(s){const a=j(),{setting:f}=V(a);return(p,t)=>(o(),l("div",null,[De,Ce,J(e("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors","onUpdate:modelValue":t[0]||(t[0]=d=>s.data.title=d),placeholder:"有什么新鲜事要向大家分享？",maxlength:"30"},null,512),[[H,s.data.title]]),Ne,c(f).legacyEditor?(o(),I(me,{key:0,modelValue:s.data.content,"onUpdate:modelValue":t[1]||(t[1]=d=>s.data.content=d)},null,8,["modelValue"])):(o(),I(fe,{key:1,class:"h-[400px]",modelValue:s.data.content,"onUpdate:modelValue":t[2]||(t[2]=d=>s.data.content=d)},null,8,["modelValue"])),n($,{class:"mt-2",primary:"",onClick:t[3]||(t[3]=d=>p.$emit("newPost"))},{default:m(()=>[b("发布")]),_:1})]))}}),Ie={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4 relative"},Se={key:0,class:"absolute top-4 right-4"},Le={key:1,class:"text-center"},Be={key:2,class:"flex flex-col w-full items-center"},qe=["src"],Ee={class:"font-bold mt-4"},Me={class:"text-gray-500"},Re={class:"mt-2"},je={class:"mr-2 text-sm bg-yellow-300 px-1 py-0.5 rounded-md"},Te={class:"mr-2 text-sm bg-red-300 px-1 py-0.5 rounded-md"},Ue={key:0,class:"mr-2 text-sm bg-red-500 px-1 py-0.5 rounded-md text-white"},ze={key:0,class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},Ae={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-2"},Fe={key:0,class:"text-center pb-4"},Oe=e("span",null,"这里还什么都没有呢",-1),Ge=[Oe],ot=S({__name:"user-profile",setup(s){const a=j(),f=K(),p=Q(),t=W(),{login:d}=V(a),{params:L}=V(f),P=_(String(f.params.uid)),u=_(),N=_([]),h=_({title:"",content:""}),D=_(1),B=_(0),g=X(()=>d.value&&P.value==String(a.uid));Y(()=>{L.value.uid&&(P.value=String(L.value.uid),w())}),Z(()=>{f.query.page&&(D.value=Number(f.query.page)),w()});async function w(){R.start(),a.pageLoading=!0;const r=ee(Number(P.value)),y=ae(D.value,Number(P.value));return Promise.all([r,y]).then(([v,x])=>{var k;u.value=v.userInfo,N.value=x.posts,B.value=x.count,document.title=((k=u.value)==null?void 0:k.nickname)+"的主页 - Ori博客"}).catch(v=>{t.error(v.message)}).finally(()=>{R.done(),a.pageLoading=!1})}async function T(){if(h.value.title.trim()==""){t.warning("文章标题不可为空");return}if(h.value.content.trim()==""){t.warning("文章内容不可为空");return}ne(a.token,h.value.title.trim(),h.value.content.trim()).then(r=>{t.success("发布成功"),h.value.title="",h.value.content="",w()}).catch(r=>{t.error("发布失败: "+r)})}async function U(r){le(a.token,r).then(y=>{t.success("删除成功"),w()}).catch(y=>{t.error("删除失败: "+y.message)})}function z(){p.push("/admin")}function A(){localStorage.removeItem("uid"),localStorage.removeItem("token"),localStorage.removeItem("likeCache"),a.login=!1,a.uid=0,a.token=""}function F(r){D.value=r,p.push({query:{page:r}}),w()}return(r,y)=>{var v,x,k,q,E;return o(),l("div",null,[e("div",Ie,[c(g)?(o(),l("div",Se,[n($,{onClick:z},{default:m(()=>[b("进入后台")]),_:1}),n($,{class:"ml-1",onClick:A},{default:m(()=>[b("退出登录")]),_:1})])):C("",!0),e("h2",null,i(c(g)?"我的":"用户")+"信息",1),te(r.$slots,"loading"),u.value?(o(),l("div",Be,[e("img",{class:"rounded-full w-[120px] h-[120px] shadow-md",src:(v=u.value)==null?void 0:v.avatar,alt:"user avatar"},null,8,qe),e("span",Ee,i((x=u.value)==null?void 0:x.nickname),1),e("span",Me,"@"+i((k=u.value)==null?void 0:k.name),1),e("div",Re,[e("span",je,"uid:"+i((q=u.value)==null?void 0:q.uid),1),e("span",Te,"用户组:"+i((E=u.value)==null?void 0:E.role),1),u.value.status!==0?(o(),l("span",Ue,"用户已被封禁")):C("",!0)])])):(o(),l("div",Le,"加载中"))]),c(g)?(o(),l("div",ze,[n(Ve,{data:h.value,onNewPost:T},null,8,["data"])])):C("",!0),e("div",Ae,[e("h2",null,i(c(g)?"我的":"用户")+"文章",1),N.value.length==0?(o(),l("div",Fe,Ge)):(o(),l(M,{key:1},[(o(!0),l(M,null,se(N.value,O=>(o(),I(Pe,{"post-data":O,"edit-mode":c(g),onDelete:U},null,8,["post-data","edit-mode"]))),256)),n(ce,{"current-page":D.value,"total-count":B.value,"page-size":c(oe),onChange:F},null,8,["current-page","total-count","page-size"])],64))])])}}});export{ot as default};
