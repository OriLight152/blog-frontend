import{d as C,u as P,v as B,j as D,t as H,r as i,o as L,J as n,H as S,c as p,h as l,A as f,B as m,k as u,a as v,w as g,e as z,x as E,I as h,g as x}from"./index-7fb9b2a6.js";import{N as w}from"./nprogress-131c7954.js";import{b as I,f as M}from"./post-0ff8842a.js";import{_ as b}from"./NormalButton.vue_vue_type_script_setup_true_lang-77d36fc7.js";const R={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},U=u("h2",null,"编辑文章",-1),$={key:0},G=C({__name:"EditPost",setup(j){const r=P(),y=B(),s=D(),{login:_,uid:k}=H(r),N=i(String(y.params.pid)),e=i(null),d=i(null);L(async()=>{if(!_.value){s.warning("请先登录"),n.push("/login");return}w.start(),await T(),w.done()}),S(e,async()=>{console.log("trigger resize textarea"),await h(),c(d.value)});async function T(){r.pageLoading=!0,I(Number(N.value)).then(a=>{var t;if(e.value=a.post,r.pageLoading=!1,k.value!==((t=e.value)==null?void 0:t.author)){s.warning("你没有权限编辑此文章"),n.push("/profile");return}}).catch(a=>{r.pageLoading=!1})}async function V(){var a,t;if(((a=e.value)==null?void 0:a.title.trim())===""){s.warning("文章标题不可为空");return}if(((t=e.value)==null?void 0:t.text.trim())===""){s.warning("文章内容不可为空");return}e.value&&M(r.token,e.value.pid,e.value.title.trim(),e.value.text.trim()).then(o=>{s.success("保存成功"),n.back()}).catch(o=>{s.error("保存失败："+o.message)})}function c(a){a.style.height="100px",h(()=>{a.style.height=a.scrollHeight+"px"})}return(a,t)=>(x(),p("div",R,[U,e.value?(x(),p("div",$,[l(" 标题： "),f(u("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors",type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>e.value.title=o)},null,512),[[m,e.value.title]]),l(" 内容： "),f(u("textarea",{class:"w-full h-[100px] p-2 rounded-md border resize-none hover:border-blue-500 transition-colors overflow-y-hidden","onUpdate:modelValue":t[1]||(t[1]=o=>e.value.text=o),onInput:t[2]||(t[2]=o=>c(o.target)),ref_key:"eleTextarea",ref:d},null,544),[[m,e.value.text]]),v(b,{primary:"",onClick:V},{default:g(()=>[l("保存修改")]),_:1}),v(b,{onClick:t[3]||(t[3]=o=>z(n).back())},{default:g(()=>[l("取消")]),_:1})])):E("",!0)]))}});export{G as default};
