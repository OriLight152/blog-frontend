import{d as R,o as n,c as l,a as e,f as s,g as c,e as r,w as p,y as v,h as N,b as A,u as O,q as G,s as J,t as K,r as h,j as Q,B as W,k as X,D as Y,v as z,x as j,F as B,l as Z,z as ee,i as te,p as se}from"./index-1b310fc9.js";import{N as C,g as oe,d as ae,f as ne}from"./post-d5b08c31.js";import{f as le,I as re,a as ie,b as de}from"./IconView-4abe3fac.js";import{N as I}from"./NormalButton-7170d271.js";import{_ as ue}from"./Pagination.vue_vue_type_script_setup_true_lang-537947bf.js";const ce={class:"w-full bg-gray-100 my-2 rounded-[12px] overflow-hidden"},me={class:"flex pt-6 px-4"},he={class:"w-full flex flex-row justify-between"},pe={class:"text-gray-500 flex items-center"},fe={key:0},ve={class:"pl-4 pr-8"},_e={class:"text-2xl leading-[60px]"},ge={class:""},we={class:"flex h-10 mt-4"},xe={class:"h-full flex items-center justify-center hover:bg-gray-500/10 transition-colors"},ye={class:"flex-1 flex items-center justify-center hover:bg-gray-500/10 transition-colors"},be=R({__name:"UserProfilePost",props:{postData:null,editMode:{type:Boolean}},emits:["delete"],setup(o,{emit:d}){return(P,i)=>{const _=A("RouterLink");return n(),l("div",ce,[e("div",me,[e("div",he,[e("div",pe,[e("span",null,"发布于："+s(c(le)(o.postData.createdAt)),1),r(re,{class:"w-4 h-4 inline-block ml-2 mr-1"}),e("span",null,s(o.postData.viewCount),1)]),o.editMode?(n(),l("div",fe,[r(_,{class:"mr-1",to:"/post/edit/"+o.postData.pid},{default:p(()=>[r(I,null,{default:p(()=>[v("编辑")]),_:1})]),_:1},8,["to"]),r(I,{onClick:i[0]||(i[0]=V=>d("delete",o.postData.pid))},{default:p(()=>[v("删除")]),_:1})])):N("",!0)])]),r(_,{to:"/post/"+o.postData.pid},{default:p(()=>[e("div",ve,[e("p",_e,s(o.postData.title),1),e("p",ge,s(o.postData.text),1)])]),_:1},8,["to"]),e("div",we,[r(_,{class:"flex-1",to:{path:"/post/"+o.postData.pid,query:{navigate:"comments"}}},{default:p(()=>[e("div",xe,[r(ie,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,s(o.postData._count.comments),1)])]),_:1},8,["to"]),e("div",ye,[r(de,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,s(o.postData.like),1)])])])}}}),ke={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4 relative"},Pe={key:0,class:"absolute top-4 right-4"},De={key:1,class:"text-center"},$e={key:2,class:"flex flex-col w-full items-center"},Ce=["src"],Ne={class:"font-bold mt-4"},Ie={class:"text-gray-500"},Se={class:"mt-2"},Be={class:"mr-2 text-sm bg-yellow-300 px-1 py-0.5 rounded-md"},Ve={class:"mr-2 text-sm bg-red-300 px-1 py-0.5 rounded-md"},Le={key:0,class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},Me=e("h2",null,"新博文",-1),Te={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-2"},ze={key:0,class:"text-center pb-4"},je=e("span",null,"这里还什么都没有呢",-1),Re=[je],Ue={key:1,class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},qe=e("h2",null,"开发数据",-1),Ge=R({__name:"UserProfile",setup(o){const d=O(),P=G(),i=J(),{devMode:_,login:V}=K(d),D=h(String(P.params.uid)),u=h(),$=h([]),g=h(""),w=h(""),S=h(1),L=h(0),x=Q(()=>V.value&&D.value==String(d.uid));W(P,async(t,a)=>{C.start(),D.value=String(P.params.uid),await y(),C.done()}),X(()=>{y()});async function y(){C.start();const t=Y(Number(D.value)),a=oe(S.value,Number(D.value));return Promise.all([t,a]).then(([f,b])=>{var k;u.value=f.userInfo,$.value=b.posts,L.value=b.count,document.title=((k=u.value)==null?void 0:k.nickname)+"的主页 - 博客"}).catch(f=>{i.error(f.message)}).finally(()=>{C.done()})}async function U(){if(g.value.trim()==""){i.warning("文章标题不可为空");return}if(w.value.trim()==""){i.warning("文章内容不可为空");return}ae(d.token,g.value.trim(),w.value.trim()).then(t=>{i.success("发布成功"),g.value="",w.value="",y()}).catch(t=>{i.error("发布失败: "+t)})}async function q(t){ne(d.token,t).then(a=>{i.success("删除成功"),y()}).catch(a=>{i.error("删除失败: "+a)})}function E(){localStorage.removeItem("uid"),localStorage.removeItem("token"),d.login=!1,d.uid=0,d.token=""}async function F(t){S.value=t,await y()}async function H(t){t.style.height="100px",await ee(),t.style.height=t.scrollHeight+"px"}return(t,a)=>{var f,b,k,M,T;return n(),l(B,null,[e("div",ke,[c(x)?(n(),l("div",Pe,[r(I,{onClick:E},{default:p(()=>[v("退出登录")]),_:1})])):N("",!0),e("h2",null,s(c(x)?"我的":"用户")+"信息",1),u.value?(n(),l("div",$e,[e("img",{class:"rounded-full w-[120px] h-[120px] shadow-md",src:(f=u.value)==null?void 0:f.avatar,alt:"user avatar"},null,8,Ce),e("span",Ne,s((b=u.value)==null?void 0:b.nickname),1),e("span",Ie,"@"+s((k=u.value)==null?void 0:k.name),1),e("div",Se,[e("span",Be,"uid:"+s((M=u.value)==null?void 0:M.uid),1),e("span",Ve,"用户组:"+s((T=u.value)==null?void 0:T.role),1)])])):(n(),l("div",De,"加载中"))]),c(x)?(n(),l("div",Le,[Me,v(" 标题： "),z(e("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors","onUpdate:modelValue":a[0]||(a[0]=m=>g.value=m),placeholder:"有什么新鲜事要向大家分享？",maxlength:"30"},null,512),[[j,g.value]]),v(" 内容： "),z(e("textarea",{class:"w-full h-[100px] p-2 rounded-md border resize-none hover:border-blue-500 transition-colors overflow-y-hidden","onUpdate:modelValue":a[1]||(a[1]=m=>w.value=m),placeholder:"",onInput:a[2]||(a[2]=m=>H(m.target))},null,544),[[j,w.value]]),r(I,{onClick:U},{default:p(()=>[v("发布")]),_:1})])):N("",!0),e("div",Te,[e("h2",null,s(c(x)?"我的":"用户")+"博客",1),$.value.length==0?(n(),l("div",ze,Re)):(n(),l(B,{key:1},[(n(!0),l(B,null,Z($.value,m=>(n(),te(be,{"post-data":m,"edit-mode":c(x),onDelete:q},null,8,["post-data","edit-mode"]))),256)),r(ue,{"current-page":S.value,"total-count":L.value,"page-size":c(se),onChange:F},null,8,["current-page","total-count","page-size"])],64))]),c(_)?(n(),l("div",Ue,[qe,e("p",null,"userProfile: "+s(u.value),1),e("p",null,"userPosts: "+s($.value),1)])):N("",!0)],64)}}});export{Ge as default};
