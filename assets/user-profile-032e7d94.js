import{d as B,i as o,c as l,m as e,n as i,g as c,e as n,w as m,j as b,y as N,h as q,u as T,t as S,B as H,C as J,k as L,a as K,b as Q,l as W,r as _,s as X,H as Y,o as Z,A as ee,F as I,f as te,p as se}from"./index-8d1e5d37.js";import{N as j}from"./nprogress-a817ebd9.js";import{g as oe,h as ae,d as ne}from"./post-79ada9e7.js";import{_ as P}from"./NormalButton.vue_vue_type_script_setup_true_lang-ea2df4d5.js";import{f as le}from"./index-74aade08.js";import{I as ie,a as re,b as de}from"./IconView-d6afd660.js";import{_ as ue}from"./Pagination.vue_vue_type_script_setup_true_lang-c74fb911.js";import{_ as ce}from"./MarkdownEditor.vue_vue_type_script_setup_true_lang-4de768b1.js";import"./_commonjsHelpers-28e086c5.js";import"./_plugin-vue_export-helper-c27b6911.js";const me={class:"w-full bg-gray-100 my-2 rounded-[12px] overflow-hidden"},fe={class:"flex pt-6 px-4"},pe={class:"w-full flex flex-row justify-between"},he={class:"text-gray-500 flex items-center"},ve={key:0},_e={class:"pl-4 pr-8"},ge={class:"text-2xl leading-[60px]"},we={class:""},xe={class:"flex h-10 mt-4"},ye={class:"h-full flex items-center justify-center hover:bg-gray-500/10 transition-colors"},ke={class:"flex-1 flex items-center justify-center hover:bg-gray-500/10 transition-colors"},be=B({__name:"UserProfilePost",props:{postData:null,editMode:{type:Boolean}},emits:["delete"],setup(s,{emit:a}){return(f,p)=>{const t=q("RouterLink");return o(),l("div",me,[e("div",fe,[e("div",pe,[e("div",he,[e("span",null,"发布于："+i(c(le)(s.postData.createdAt)),1),n(ie,{class:"w-4 h-4 inline-block ml-2 mr-1"}),e("span",null,i(s.postData.viewCount),1)]),s.editMode?(o(),l("div",ve,[n(t,{class:"mr-1",to:"/post/edit/"+s.postData.pid},{default:m(()=>[n(P,null,{default:m(()=>[b("编辑")]),_:1})]),_:1},8,["to"]),n(P,{onClick:p[0]||(p[0]=$=>a("delete",s.postData.pid))},{default:m(()=>[b("删除")]),_:1})])):N("",!0)])]),n(t,{to:"/post/"+s.postData.pid},{default:m(()=>[e("div",_e,[e("p",ge,i(s.postData.title),1),e("p",we,i(s.postData.text),1)])]),_:1},8,["to"]),e("div",xe,[n(t,{class:"flex-1",to:{path:"/post/"+s.postData.pid,query:{navigate:"comments"}}},{default:m(()=>[e("div",ye,[n(re,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,i(s.postData._count.comments),1)])]),_:1},8,["to"]),e("div",ke,[n(de,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,i(s.postData.like),1)])])])}}}),Pe=e("h2",null,"新文章",-1),$e=e("p",{class:"my-2 font-bold"},"标题",-1),De=e("p",{class:"my-2 font-bold"},"内容",-1),Ce=B({__name:"NewPost",props:{data:null},emits:["newPost"],setup(s){const a=T(),{setting:f}=S(a);return(p,t)=>{const $=q("NormalEditor");return o(),l("div",null,[Pe,$e,H(e("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors","onUpdate:modelValue":t[0]||(t[0]=d=>s.data.title=d),placeholder:"有什么新鲜事要向大家分享？",maxlength:"30"},null,512),[[J,s.data.title]]),De,c(f).legacyEditor?(o(),L($,{key:0,modelValue:s.data.content,"onUpdate:modelValue":t[1]||(t[1]=d=>s.data.content=d)},null,8,["modelValue"])):(o(),L(ce,{key:1,class:"h-[400px]",modelValue:s.data.content,"onUpdate:modelValue":t[2]||(t[2]=d=>s.data.content=d)},null,8,["modelValue"])),n(P,{class:"mt-2",primary:"",onClick:t[3]||(t[3]=d=>p.$emit("newPost"))},{default:m(()=>[b("发布")]),_:1})])}}}),Ne={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4 relative"},Ve={key:0,class:"absolute top-4 right-4"},Ie={key:1,class:"text-center"},Se={key:2,class:"flex flex-col w-full items-center"},Le=["src"],Be={class:"font-bold mt-4"},Ee={class:"text-gray-500"},Me={class:"mt-2"},Re={class:"mr-2 text-sm bg-yellow-300 px-1 py-0.5 rounded-md"},je={class:"mr-2 text-sm bg-red-300 px-1 py-0.5 rounded-md"},qe={key:0,class:"mr-2 text-sm bg-red-500 px-1 py-0.5 rounded-md text-white"},Te={key:0,class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},Ue={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-2"},ze={key:0,class:"text-center pb-4"},Ae=e("span",null,"这里还什么都没有呢",-1),Fe=[Ae],et=B({__name:"user-profile",setup(s){const a=T(),f=K(),p=Q(),t=W(),{login:$}=S(a),{params:d}=S(f),D=_(String(f.params.uid)),u=_(),V=_([]),h=_({title:"",content:""}),C=_(1),E=_(0),g=X(()=>$.value&&D.value==String(a.uid));Y(()=>{d.value.uid&&(D.value=String(d.value.uid),w())}),Z(()=>{f.query.page&&(C.value=Number(f.query.page)),w()});async function w(){j.start(),a.pageLoading=!0;const r=ee(Number(D.value)),x=oe(C.value,Number(D.value));return Promise.all([r,x]).then(([v,y])=>{var k;u.value=v.userInfo,V.value=y.posts,E.value=y.count,document.title=((k=u.value)==null?void 0:k.nickname)+"的主页 - Ori博客"}).catch(v=>{t.error(v.message)}).finally(()=>{j.done(),a.pageLoading=!1})}async function U(){if(h.value.title.trim()==""){t.warning("文章标题不可为空");return}if(h.value.content.trim()==""){t.warning("文章内容不可为空");return}ae(a.token,h.value.title.trim(),h.value.content.trim()).then(r=>{t.success("发布成功"),h.value.title="",h.value.content="",w()}).catch(r=>{t.error("发布失败: "+r)})}async function z(r){ne(a.token,r).then(x=>{t.success("删除成功"),w()}).catch(x=>{t.error("删除失败: "+x.message)})}function A(){p.push("/admin")}function F(){localStorage.removeItem("uid"),localStorage.removeItem("token"),localStorage.removeItem("likeCache"),a.login=!1,a.uid=0,a.token=""}function O(r){C.value=r,p.push({query:{page:r}}),w()}return(r,x)=>{var v,y,k,M,R;return o(),l(I,null,[e("div",Ne,[c(g)?(o(),l("div",Ve,[n(P,{onClick:A},{default:m(()=>[b("进入后台")]),_:1}),n(P,{class:"ml-1",onClick:F},{default:m(()=>[b("退出登录")]),_:1})])):N("",!0),e("h2",null,i(c(g)?"我的":"用户")+"信息",1),u.value?(o(),l("div",Se,[e("img",{class:"rounded-full w-[120px] h-[120px] shadow-md",src:(v=u.value)==null?void 0:v.avatar,alt:"user avatar"},null,8,Le),e("span",Be,i((y=u.value)==null?void 0:y.nickname),1),e("span",Ee,"@"+i((k=u.value)==null?void 0:k.name),1),e("div",Me,[e("span",Re,"uid:"+i((M=u.value)==null?void 0:M.uid),1),e("span",je,"用户组:"+i((R=u.value)==null?void 0:R.role),1),u.value.status!==0?(o(),l("span",qe,"用户已被封禁")):N("",!0)])])):(o(),l("div",Ie,"加载中"))]),c(g)?(o(),l("div",Te,[n(Ce,{data:h.value,onNewPost:U},null,8,["data"])])):N("",!0),e("div",Ue,[e("h2",null,i(c(g)?"我的":"用户")+"文章",1),V.value.length==0?(o(),l("div",ze,Fe)):(o(),l(I,{key:1},[(o(!0),l(I,null,te(V.value,G=>(o(),L(be,{"post-data":G,"edit-mode":c(g),onDelete:z},null,8,["post-data","edit-mode"]))),256)),n(ue,{"current-page":C.value,"total-count":E.value,"page-size":c(se),onChange:O},null,8,["current-page","total-count","page-size"])],64))])],64)}}});export{et as default};
