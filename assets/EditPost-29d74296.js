import{d as k,u as T,q as V,h as B,t as C,r as n,o as P,B as l,C as z,c as f,y as i,v,x as h,j as u,b as D,w as L,s as S,z as m,f as g}from"./index-f715197c.js";import{N as x,d as E,f as H}from"./nprogress-2de68035.js";import{N as M}from"./NormalButton-f36f5c9a.js";const R={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},U=u("h2",null,"编辑文章",-1),j={key:0},G=k({__name:"EditPost",setup(q){const r=T(),w=V(),s=B(),{login:y,uid:b}=C(r),d=n(String(w.params.pid)),e=n(null),c=n(null);P(async()=>{if(!y.value){s.warning("请先登录"),l.push("/login");return}x.start(),await _(),x.done()}),z(e,async()=>{console.log("trigger resize textarea"),await m(),p(c.value)});async function _(){r.pageLoading=!0,E(Number(d.value)).then(a=>{var t;if(e.value=a.post,r.pageLoading=!1,b.value!==((t=e.value)==null?void 0:t.author)){s.warning("你没有权限编辑此文章"),l.push("/profile");return}}).catch(a=>{r.pageLoading=!1})}async function N(){var a,t;if(((a=e.value)==null?void 0:a.title.trim())===""){s.warning("文章标题不可为空");return}if(((t=e.value)==null?void 0:t.text.trim())===""){s.warning("文章内容不可为空");return}e.value&&H(r.token,e.value.pid,e.value.title.trim(),e.value.text.trim()).then(o=>{s.success("保存成功"),l.push("/post/"+d.value)}).catch(o=>{s.error("保存失败："+o)})}function p(a){a.style.height="100px",m(()=>{a.style.height=a.scrollHeight+"px"})}return(a,t)=>(g(),f("div",R,[U,e.value?(g(),f("div",j,[i(" 标题： "),v(u("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors",type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>e.value.title=o)},null,512),[[h,e.value.title]]),i(" 内容： "),v(u("textarea",{class:"w-full h-[100px] p-2 rounded-md border resize-none hover:border-blue-500 transition-colors overflow-y-hidden","onUpdate:modelValue":t[1]||(t[1]=o=>e.value.text=o),onInput:t[2]||(t[2]=o=>p(o.target)),ref_key:"eleTextarea",ref:c},null,544),[[h,e.value.text]]),D(M,{onClick:N},{default:L(()=>[i("保存修改")]),_:1})])):S("",!0)]))}});export{G as default};
