import{f as v,I as k,a as x,b as D}from"./IconView-0caece3f.js";import{I as g}from"./IconLikeS-b2e99844.js";import{d as w,g as b,h as S,t as _,r as y,i as C,e as d,c as O,b as n,w as m,j as t,k as l,u as P,f as p}from"./index-d5b50c01.js";import{s as T,c as L}from"./nprogress-52d93cfb.js";const I={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm"},B={class:"flex pt-6 px-4"},j=["src"],R={class:"flex flex-col"},V={class:"mt-2 text-lg font-bold"},N={class:"text-gray-500 flex items-center text-sm"},q={class:"ml-[80px] pl-4 pr-8"},A={class:"text-2xl leading-[60px]"},E={class:""},z={class:"flex h-10 mt-4"},F={class:"h-full flex items-center justify-center hover:bg-gray-500/10 transition-colors"},Q=w({__name:"PostPreview",props:{postData:null},setup(e){const o=e,c=b(),r=S(),{login:f,likeCache:i}=_(c),s=y(!1);f.value&&(s.value=i.value.POST.includes(o.postData.pid.toString()));function h(){if(!f.value){r.warning("请先登录");return}s.value?L(c.token,"POST",o.postData.pid).then(a=>{s.value=!s.value,o.postData.like-=1}).catch(a=>{r("取消点赞失败："+a.message)}).finally(()=>{let a=i.value.POST.indexOf(o.postData.pid.toString());a!==-1&&i.value.POST.splice(a,1)}):T(c.token,"POST",o.postData.pid).then(a=>{s.value=!s.value,o.postData.like+=1}).catch(a=>{s.value=!s.value,r("点赞失败："+a.message)}).finally(()=>{i.value.POST.push(o.postData.pid.toString())})}return(a,G)=>{const u=C("RouterLink");return d(),O("div",I,[n(u,{to:"/user/"+e.postData.user.uid},{default:m(()=>[t("div",B,[t("img",{class:"rounded-full w-16 h-16 mr-4 hover:scale-[1.1] transition-transform",src:e.postData.user.avatar,alt:"avatar"},null,8,j),t("div",R,[t("div",null,[t("span",V,l(e.postData.user.nickname),1)]),t("div",N,[t("span",null,l(P(v)(e.postData.createdAt)),1),n(k,{class:"w-4 h-4 inline-block ml-2 mr-1"}),t("span",null,l(e.postData.viewCount),1)])])])]),_:1},8,["to"]),n(u,{to:"/post/"+e.postData.pid},{default:m(()=>[t("div",q,[t("p",A,l(e.postData.title),1),t("p",E,l(e.postData.text),1)])]),_:1},8,["to"]),t("div",z,[n(u,{class:"flex-1",to:{path:"/post/"+e.postData.pid,query:{navigate:"comments"}}},{default:m(()=>[t("div",F,[n(x,{class:"w-5 h-5 inline-block mr-1"}),t("span",null,l(e.postData._count.comments),1)])]),_:1},8,["to"]),t("button",{class:"flex-1 flex items-center justify-center hover:bg-gray-500/10 transition-colors",onClick:h},[s.value?(d(),p(g,{key:0,class:"w-5 h-5 inline-block mr-1 text-red-500"})):(d(),p(D,{key:1,class:"w-5 h-5 inline-block mr-1"})),t("span",null,l(e.postData.like),1)])])])}}});export{Q as _};
