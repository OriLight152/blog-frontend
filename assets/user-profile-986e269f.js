import{d as I,i as l,c as r,m as e,n as d,g as p,e as i,w as m,j as f,z as D,h as O,D as B,E as R,N as G,u as J,a as K,b as Q,l as W,t as T,r as _,s as X,M as Y,o as Z,C as ee,F as N,f as te,k as se,p as oe}from"./index-3e818f2b.js";import{N as j}from"./nprogress-131c7954.js";import{g as ae,h as ne,d as le}from"./post-00035af5.js";import{_ as k}from"./NormalButton.vue_vue_type_script_setup_true_lang-3c593dc6.js";import{f as ie}from"./index-b25eac40.js";import{I as re,a as de,b as ue}from"./IconView-98635154.js";import{_ as ce}from"./Pagination.vue_vue_type_script_setup_true_lang-e990d50d.js";const me={class:"w-full bg-gray-100 my-2 rounded-[12px] overflow-hidden"},he={class:"flex pt-6 px-4"},pe={class:"w-full flex flex-row justify-between"},fe={class:"text-gray-500 flex items-center"},ve={key:0},ge={class:"pl-4 pr-8"},_e={class:"text-2xl leading-[60px]"},xe={class:""},we={class:"flex h-10 mt-4"},ye={class:"h-full flex items-center justify-center hover:bg-gray-500/10 transition-colors"},be={class:"flex-1 flex items-center justify-center hover:bg-gray-500/10 transition-colors"},ke=I({__name:"UserProfilePost",props:{postData:null,editMode:{type:Boolean}},emits:["delete"],setup(s,{emit:a}){return(u,o)=>{const t=O("RouterLink");return l(),r("div",me,[e("div",he,[e("div",pe,[e("div",fe,[e("span",null,"发布于："+d(p(ie)(s.postData.createdAt)),1),i(re,{class:"w-4 h-4 inline-block ml-2 mr-1"}),e("span",null,d(s.postData.viewCount),1)]),s.editMode?(l(),r("div",ve,[i(t,{class:"mr-1",to:"/post/edit/"+s.postData.pid},{default:m(()=>[i(k,null,{default:m(()=>[f("编辑")]),_:1})]),_:1},8,["to"]),i(k,{onClick:o[0]||(o[0]=S=>a("delete",s.postData.pid))},{default:m(()=>[f("删除")]),_:1})])):D("",!0)])]),i(t,{to:"/post/"+s.postData.pid},{default:m(()=>[e("div",ge,[e("p",_e,d(s.postData.title),1),e("p",xe,d(s.postData.text),1)])]),_:1},8,["to"]),e("div",we,[i(t,{class:"flex-1",to:{path:"/post/"+s.postData.pid,query:{navigate:"comments"}}},{default:m(()=>[e("div",ye,[i(de,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,d(s.postData._count.comments),1)])]),_:1},8,["to"]),e("div",be,[i(ue,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,d(s.postData.like),1)])])])}}}),Pe=e("h2",null,"新文章",-1),$e=I({__name:"NewPost",props:{data:null},emits:["newPost"],setup(s){async function a(u){u.style.height="100px",await G(),u.style.height=u.scrollHeight+"px"}return(u,o)=>(l(),r("div",null,[Pe,f(" 标题： "),B(e("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors","onUpdate:modelValue":o[0]||(o[0]=t=>s.data.title=t),placeholder:"有什么新鲜事要向大家分享？",maxlength:"30"},null,512),[[R,s.data.title]]),f(" 内容： "),B(e("textarea",{class:"w-full min-h-[100px] p-2 rounded-md border hover:border-blue-500 transition-colors overflow-y-hidden","onUpdate:modelValue":o[1]||(o[1]=t=>s.data.content=t),placeholder:"",onInput:o[2]||(o[2]=t=>a(t.target))},null,544),[[R,s.data.content]]),i(k,{onClick:o[3]||(o[3]=t=>u.$emit("newPost"))},{default:m(()=>[f("发布")]),_:1})]))}}),De={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4 relative"},Ce={key:0,class:"absolute top-4 right-4"},Ne={key:1,class:"text-center"},Ie={key:2,class:"flex flex-col w-full items-center"},Se=["src"],Le={class:"font-bold mt-4"},Ve={class:"text-gray-500"},Me={class:"mt-2"},Be={class:"mr-2 text-sm bg-yellow-300 px-1 py-0.5 rounded-md"},Re={class:"mr-2 text-sm bg-red-300 px-1 py-0.5 rounded-md"},Te={key:0,class:"mr-2 text-sm bg-red-500 px-1 py-0.5 rounded-md text-white"},je={key:0,class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},qe={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-2"},ze={key:0,class:"text-center pb-4"},Ee=e("span",null,"这里还什么都没有呢",-1),Ue=[Ee],Qe=I({__name:"user-profile",setup(s){const a=J(),u=K(),o=Q(),t=W(),{login:S}=T(a),{params:q}=T(u),P=_(String(u.params.uid)),c=_(),C=_([]),h=_({title:"",content:""}),$=_(1),L=_(0),x=X(()=>S.value&&P.value==String(a.uid));Y(q,(n,v)=>{n.uid&&(P.value=String(n.uid),w())}),Z(()=>{u.query.page&&($.value=Number(u.query.page)),w()});async function w(){j.start(),a.pageLoading=!0;const n=ee(Number(P.value)),v=ae($.value,Number(P.value));return Promise.all([n,v]).then(([g,y])=>{var b;c.value=g.userInfo,C.value=y.posts,L.value=y.count,document.title=((b=c.value)==null?void 0:b.nickname)+"的主页 - Ori博客"}).catch(g=>{t.error(g.message)}).finally(()=>{j.done(),a.pageLoading=!1})}async function z(){if(h.value.title.trim()==""){t.warning("文章标题不可为空");return}if(h.value.content.trim()==""){t.warning("文章内容不可为空");return}ne(a.token,h.value.title.trim(),h.value.content.trim()).then(n=>{t.success("发布成功"),h.value.title="",h.value.content="",w()}).catch(n=>{t.error("发布失败: "+n)})}async function E(n){le(a.token,n).then(v=>{t.success("删除成功"),w()}).catch(v=>{t.error("删除失败: "+v.message)})}function U(){o.push("/admin")}function A(){localStorage.removeItem("uid"),localStorage.removeItem("token"),localStorage.removeItem("likeCache"),a.login=!1,a.uid=0,a.token=""}function F(n){$.value=n,o.push({query:{page:n}}),w()}return(n,v)=>{var g,y,b,V,M;return l(),r(N,null,[e("div",De,[p(x)?(l(),r("div",Ce,[i(k,{onClick:U},{default:m(()=>[f("进入后台")]),_:1}),i(k,{class:"ml-1",onClick:A},{default:m(()=>[f("退出登录")]),_:1})])):D("",!0),e("h2",null,d(p(x)?"我的":"用户")+"信息",1),c.value?(l(),r("div",Ie,[e("img",{class:"rounded-full w-[120px] h-[120px] shadow-md",src:(g=c.value)==null?void 0:g.avatar,alt:"user avatar"},null,8,Se),e("span",Le,d((y=c.value)==null?void 0:y.nickname),1),e("span",Ve,"@"+d((b=c.value)==null?void 0:b.name),1),e("div",Me,[e("span",Be,"uid:"+d((V=c.value)==null?void 0:V.uid),1),e("span",Re,"用户组:"+d((M=c.value)==null?void 0:M.role),1),c.value.status!==0?(l(),r("span",Te,"用户已被封禁")):D("",!0)])])):(l(),r("div",Ne,"加载中"))]),p(x)?(l(),r("div",je,[i($e,{data:h.value,onNewPost:z},null,8,["data"])])):D("",!0),e("div",qe,[e("h2",null,d(p(x)?"我的":"用户")+"文章",1),C.value.length==0?(l(),r("div",ze,Ue)):(l(),r(N,{key:1},[(l(!0),r(N,null,te(C.value,H=>(l(),se(ke,{"post-data":H,"edit-mode":p(x),onDelete:E},null,8,["post-data","edit-mode"]))),256)),i(ce,{"current-page":$.value,"total-count":L.value,"page-size":p(oe),onChange:F},null,8,["current-page","total-count","page-size"])],64))])],64)}}});export{Qe as default};
