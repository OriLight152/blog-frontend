import{d as N,g as n,c as r,k as e,l as d,e as p,a as l,w as m,h as f,x as $,f as F,A as M,B as R,I as q,u as G,v as O,s as J,j as K,t as Q,r as _,n as W,H as X,o as Y,z as Z,F as I,b as ee,i as te,p as se}from"./index-04964f10.js";import{N as T}from"./nprogress-131c7954.js";import{g as oe,i as ae,d as ne}from"./post-ccc0478a.js";import{_ as b}from"./NormalButton.vue_vue_type_script_setup_true_lang-b8cca322.js";import{f as le}from"./index-b25eac40.js";import{I as ie,a as re,b as de}from"./IconView-b90aaa53.js";import{_ as ue}from"./Pagination.vue_vue_type_script_setup_true_lang-fc467034.js";const ce={class:"w-full bg-gray-100 my-2 rounded-[12px] overflow-hidden"},me={class:"flex pt-6 px-4"},he={class:"w-full flex flex-row justify-between"},pe={class:"text-gray-500 flex items-center"},fe={key:0},ve={class:"pl-4 pr-8"},ge={class:"text-2xl leading-[60px]"},_e={class:""},xe={class:"flex h-10 mt-4"},we={class:"h-full flex items-center justify-center hover:bg-gray-500/10 transition-colors"},ye={class:"flex-1 flex items-center justify-center hover:bg-gray-500/10 transition-colors"},ke=N({__name:"UserProfilePost",props:{postData:null,editMode:{type:Boolean}},emits:["delete"],setup(s,{emit:o}){return(u,a)=>{const t=F("RouterLink");return n(),r("div",ce,[e("div",me,[e("div",he,[e("div",pe,[e("span",null,"发布于："+d(p(le)(s.postData.createdAt)),1),l(ie,{class:"w-4 h-4 inline-block ml-2 mr-1"}),e("span",null,d(s.postData.viewCount),1)]),s.editMode?(n(),r("div",fe,[l(t,{class:"mr-1",to:"/post/edit/"+s.postData.pid},{default:m(()=>[l(b,null,{default:m(()=>[f("编辑")]),_:1})]),_:1},8,["to"]),l(b,{onClick:a[0]||(a[0]=S=>o("delete",s.postData.pid))},{default:m(()=>[f("删除")]),_:1})])):$("",!0)])]),l(t,{to:"/post/"+s.postData.pid},{default:m(()=>[e("div",ve,[e("p",ge,d(s.postData.title),1),e("p",_e,d(s.postData.text),1)])]),_:1},8,["to"]),e("div",xe,[l(t,{class:"flex-1",to:{path:"/post/"+s.postData.pid,query:{navigate:"comments"}}},{default:m(()=>[e("div",we,[l(re,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,d(s.postData._count.comments),1)])]),_:1},8,["to"]),e("div",ye,[l(de,{class:"w-5 h-5 inline-block mr-1"}),e("span",null,d(s.postData.like),1)])])])}}}),be=e("h2",null,"新博文",-1),Pe=N({__name:"NewPost",props:{data:null},emits:["newPost"],setup(s){async function o(u){u.style.height="100px",await q(),u.style.height=u.scrollHeight+"px"}return(u,a)=>(n(),r("div",null,[be,f(" 标题： "),M(e("input",{class:"w-full p-2 rounded-md border hover:border-blue-500 transition-colors","onUpdate:modelValue":a[0]||(a[0]=t=>s.data.title=t),placeholder:"有什么新鲜事要向大家分享？",maxlength:"30"},null,512),[[R,s.data.title]]),f(" 内容： "),M(e("textarea",{class:"w-full min-h-[100px] p-2 rounded-md border hover:border-blue-500 transition-colors overflow-y-hidden","onUpdate:modelValue":a[1]||(a[1]=t=>s.data.content=t),placeholder:"",onInput:a[2]||(a[2]=t=>o(t.target))},null,544),[[R,s.data.content]]),l(b,{onClick:a[3]||(a[3]=t=>u.$emit("newPost"))},{default:m(()=>[f("发布")]),_:1})]))}}),$e={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4 relative"},De={key:0,class:"absolute top-4 right-4"},Ce={key:1,class:"text-center"},Ie={key:2,class:"flex flex-col w-full items-center"},Ne=["src"],Se={class:"font-bold mt-4"},Le={class:"text-gray-500"},Ve={class:"mt-2"},Be={class:"mr-2 text-sm bg-yellow-300 px-1 py-0.5 rounded-md"},Me={class:"mr-2 text-sm bg-red-300 px-1 py-0.5 rounded-md"},Re={key:0,class:"mr-2 text-sm bg-red-500 px-1 py-0.5 rounded-md text-white"},Te={key:0,class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-4"},je={class:"w-full bg-white my-2 rounded-md overflow-hidden shadow-sm px-4 pt-2 pb-2"},ze={key:0,class:"text-center pb-4"},Ue=e("span",null,"这里还什么都没有呢",-1),Ae=[Ue],Ke=N({__name:"UserProfile",setup(s){const o=G(),u=O(),a=J(),t=K(),{login:S}=Q(o),P=_(String(u.params.uid)),c=_(),D=_([]),h=_({title:"",content:""}),C=_(1),L=_(0),x=W(()=>S.value&&P.value==String(o.uid));X(u,(i,v)=>{i.params.uid&&(P.value=String(i.params.uid),w())}),Y(()=>{w()});async function w(){T.start(),o.pageLoading=!0;const i=Z(Number(P.value)),v=oe(C.value,Number(P.value));return Promise.all([i,v]).then(([g,y])=>{var k;c.value=g.userInfo,D.value=y.posts,L.value=y.count,document.title=((k=c.value)==null?void 0:k.nickname)+"的主页 - 博客"}).catch(g=>{t.error(g.message)}).finally(()=>{T.done(),o.pageLoading=!1})}async function j(){if(h.value.title.trim()==""){t.warning("文章标题不可为空");return}if(h.value.content.trim()==""){t.warning("文章内容不可为空");return}ae(o.token,h.value.title.trim(),h.value.content.trim()).then(i=>{t.success("发布成功"),h.value.title="",h.value.content="",w()}).catch(i=>{t.error("发布失败: "+i)})}async function z(i){ne(o.token,i).then(v=>{t.success("删除成功"),w()}).catch(v=>{t.error("删除失败: "+v.message)})}function U(){a.push("/admin")}function A(){localStorage.removeItem("uid"),localStorage.removeItem("token"),localStorage.removeItem("likeCache"),o.login=!1,o.uid=0,o.token=""}async function H(i){C.value=i,await w()}return(i,v)=>{var g,y,k,V,B;return n(),r(I,null,[e("div",$e,[p(x)?(n(),r("div",De,[l(b,{onClick:U},{default:m(()=>[f("进入后台")]),_:1}),l(b,{class:"ml-1",onClick:A},{default:m(()=>[f("退出登录")]),_:1})])):$("",!0),e("h2",null,d(p(x)?"我的":"用户")+"信息",1),c.value?(n(),r("div",Ie,[e("img",{class:"rounded-full w-[120px] h-[120px] shadow-md",src:(g=c.value)==null?void 0:g.avatar,alt:"user avatar"},null,8,Ne),e("span",Se,d((y=c.value)==null?void 0:y.nickname),1),e("span",Le,"@"+d((k=c.value)==null?void 0:k.name),1),e("div",Ve,[e("span",Be,"uid:"+d((V=c.value)==null?void 0:V.uid),1),e("span",Me,"用户组:"+d((B=c.value)==null?void 0:B.role),1),c.value.status!==0?(n(),r("span",Re,"用户已被封禁")):$("",!0)])])):(n(),r("div",Ce,"加载中"))]),p(x)?(n(),r("div",Te,[l(Pe,{data:h.value,onNewPost:j},null,8,["data"])])):$("",!0),e("div",je,[e("h2",null,d(p(x)?"我的":"用户")+"文章",1),D.value.length==0?(n(),r("div",ze,Ae)):(n(),r(I,{key:1},[(n(!0),r(I,null,ee(D.value,E=>(n(),te(ke,{"post-data":E,"edit-mode":p(x),onDelete:z},null,8,["post-data","edit-mode"]))),256)),l(ue,{"current-page":C.value,"total-count":L.value,"page-size":p(se),onChange:H},null,8,["current-page","total-count","page-size"])],64))])],64)}}});export{Ke as default};
